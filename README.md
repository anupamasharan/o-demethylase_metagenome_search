# o-demethylase_metagenome_search
Instructional tool to help retreive co-localised o-demethylase operons from metagenomic data

## Background
Corrinoid dependent O-demethylase enzyme systems (referred to henceforth as o-demethylases) typically consist of multiple component gene products that catalyse the important chemical modification of methylation and demethylation of aromatic ether compounds. They present a compelling biotransformation alternative to the more common S-adenosyl-methionine (SAM) dependent methyl transfer systems which catalyse the same process (as depicted in figure 1) irreversibly and therefore cannot be scaled up very well making the former systems more potent biocatalysts. Aromatic methyl ethers are degradation products of lignin, a very abundant aromatic renewable bipolymer. Demethylation of these compounds therefore is very important for development of the global bioeconomy [1].

Anaerobic acteogens and organohalide-respiring organisms encode this complicated 4-component system consisting of two methyltransferases [2] (referred henceforth as MT1 and MT2) a cobalamin dependent corrinoid protein(CP) which is the shuttle and an activating enzyme (AE) that keeps regenerating CP in the catalytic cycle. The first three components occur together, co-localised either in triplets or in pairs of one CP and MT1 or MT2. The AE occurs elsewhere in the genome (figure 2)[3]. The co-localised gene products have been heterologously produced and expressed over several years but AE remians elusive. However, the information about these enzyme systems is not organized. As a researcher working with testing anaerobic metagenomes on biodegradation of aromatics, I had to face a lot of trouble getting streamlined information about biochemically validated components to look for similar enzymes in-silico. There are different names for the enzymes as present on publicly searchable databases and three different proteins make it further complicated. Given the promise of these enzymes in the area of lignin-aromatic biotransformation, there should be a stremalined method to search for gene candidates encoding these enzymes in genomes or metagenomes of interest. There are unique features about the enzyme system that can be manipulated to selectively search for robust candidates for heterologous production and assay of the o-demethylase activity.

## The pipeline 

This tool is a five-part tutorial-style guide to enable a beginner-level bioinformatics user to be able to understand the logic behind the workflow presented to be able to extract sequences from user's metagenomic dataset, but the sequences are retrieved using a strict critieria of co-localisation to specifically find sequences that are suitable for heterlogous production and biochemical characterization, cutting other "metagenomic noise" as much as possible. However, if the target is to explore all possible sequences, then the search critieria presented can be relaxed accordingly. Also all parts of the workflow are tunable to the user preferance and level of expertise.

### Part 1 Creating a reference hmm profile

#### 1.1: Retreiving sequences

#### Note : You can make your own reference database by linking to any online repositories similar to NCBI  

In this part we will see how the reference database supplied on the project page was generated by mining sequences from <a href = "https://www.ncbi.nlm.nih.gov/refseq/"> NCBI RefSeq Database </a> using 3 previously characterised sequence templates.This is done using Biopython tools and tidied in python, supplied as a jupyter lab notebook (ref_db_creation.ipynb).

#### 1.2: Creating co-localised reference sequence database

The CP, MT1 and MT2 sequences obatined in part 1.1 can now be mined for the co-localised operons to create the reference database. Use the python script attached (python_header_function.py) and modify as per your header files. Sample csv files are attached as reference generated from step 1.1. Following extraction of co-localised headers, you can feed them to the <a href = "https://www.ncbi.nlm.nih.gov/sites/batchentrez"> batch enterez tool </a> to obtain all the fasta sequences.

#### Note : This script only searches for genes/operons that are immediately in the vicinty of each other (positions differ by +/- 1). However demethylase enzyme systems not specific to aryl-methyl ethers can have different orientations/organizations as well. Read more in this review by Schilhabel et al., 2009. <a href = "https://jb.asm.org/content/191/2/588">[4] </a>. The script can be easily modified to accommodate combinations of numerical position based organization (lines 59, 67).

#### 1.3: Build hidden markov model (using hmmer)

This part is done partly in python, partly in R (using BioConductor package) and partly using hmmer in linux. Skip the python part if your fasta files are ready to go and start with multiple sequence alignment in R.

##### 1.3.1 Biopython Enterez tools

Refer to enterez tutorial folder for these steps

##### 1.3.2 Mupliple Sequence Alignment using msa package in R

There is an <a href = "https://bioconductor.org/packages/release/bioc/html/msa.html"> msa package </a> that can be installed with BioConductor which let’s us do msa very easily in R. Make sure <a href = "https://bioconductor.org/install/"> BioConductor </a> is installed beforehand compatible with your version of RStudio. Refer to the R script (MSA.r) and generate the phylip file comaptibe with hmmer.

##### 1.3.3 hmmer tools using linux command line/terminal

If you already have a linux or OS system, you can install the hmmmer binaries in your path and directly access them through R. With a windows system it is much more difficult and needs cgywin installation. Also a bigger motivation to do this outside R was because the hmmsearch function within R cannot search using custom hmmprofiles very easily without interfacing with some other functions/packages, is not very intuitive. On terminal it can be done very easily. The following command was used (assuming hmmer is already installed following instructions on website).

Buidling hmm profile

$ hmmbuild o/p_filename.hmm input_alignment.phylip

### Part 2: Retrieve o-demethylase sequences from custom metagenomic database

#### 2.1: Download metagenomic data

#### Note: Skip this set if you have your dataset ready

This is demonstrated using biomartr package in R. Please see metegenome_dataset_download.r script.

#### 2.2: Use hmmsearch to get hits

We will use the hmm profile generated in part 1.3.3 to get o-demethylase putative hits from our dataset.

$ hmmsearch -o path/filename.out -A path_to_msa_of_all_hits.sto desired_hmm_profile_name.hmm sequence_database_to_search.faa

Alternatively hmmscan can also be used but hmmsearch is faster

Following this the hits from the “.out” file for each hmmsearch run were stored in csv file to be imported and manipulated with R. 

#### 2.3: Retreiving co-localised sequence files

The output file from step 2.2 will have the all headers belonging to CP, MT1 and MT2. These headers (in a csv format) should now go into the same python script referenced in part 1.2 tpo get sequences that are co-localised. Once you have the co-localised header list, you can go back to the metagenomic data sets to retrieve the sequences. These is a good tool which can be run on linux terminal which parses big metagenome datasets using a list of headers supplied as a text file and outputs the desried fasta sequences called <a href = "https://github.com/santiagosnchez/faSomeRecords"> faSomeRecords </a>. Any similar tool can be used to get the sequences.

### Part 3: Visualisation in trees or network diagrams

#### 3.1 : Network diagrams using igraph package in R


### 3.2 : Tree diagrams using phangorn and ape packages in R


## References
